{"remainingRequest":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!F:\\代码\\Vue 代码\\erabbit-client-pc-124\\src\\components\\library\\xtx-city.vue?vue&type=template&id=c5e4a620&scoped=true","dependencies":[{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\src\\components\\library\\xtx-city.vue","mtime":1621243079000},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1656924649801},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1656924649783},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\babel-loader\\lib\\index.js","mtime":1656924651984},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1656924654079},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1656924649801},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1656924653036}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgPGRpdiBjbGFzcz0ieHR4LWNpdHkiIHJlZj0idGFyZ2V0Ij4KICAgIDxkaXYgY2xhc3M9InNlbGVjdCIgQGNsaWNrPSJ0b2dnbGUoKSIgOmNsYXNzPSJ7YWN0aXZlOnZpc2libGV9Ij4KICAgICAgPHNwYW4gdi1pZj0iIWZ1bGxMb2NhdGlvbiIgY2xhc3M9InBsYWNlaG9sZGVyIj57e3BsYWNlaG9sZGVyfX08L3NwYW4+CiAgICAgIDxzcGFuIHYtZWxzZSBjbGFzcz0idmFsdWUiPnt7ZnVsbExvY2F0aW9ufX08L3NwYW4+CiAgICAgIDxpIGNsYXNzPSJpY29uZm9udCBpY29uLWFuZ2xlLWRvd24iPjwvaT4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ib3B0aW9uIiB2LWlmPSJ2aXNpYmxlIj4KICAgICAgPGRpdiB2LWlmPSJsb2FkaW5nIiBjbGFzcz0ibG9hZGluZyI+PC9kaXY+CiAgICAgIDx0ZW1wbGF0ZSB2LWVsc2U+CiAgICAgICAgPHNwYW4gY2xhc3M9ImVsbGlwc2lzIiBAY2xpY2s9ImNoYW5nZUl0ZW0oaXRlbSkiIHYtZm9yPSJpdGVtIGluIGN1cnJMaXN0IiA6a2V5PSJpdGVtLmNvZGUiPnt7aXRlbS5uYW1lfX08L3NwYW4+CiAgICAgIDwvdGVtcGxhdGU+CiAgICA8L2Rpdj4KICA8L2Rpdj4K"},{"version":3,"sources":["F:\\代码\\Vue 代码\\erabbit-client-pc-124\\src\\components\\library\\xtx-city.vue"],"names":[],"mappings":";EACE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAC7D,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACpE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACjD,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACzC,CAAC,CAAC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAChC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACzC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACd,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAChH,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACZ,CAAC,CAAC,CAAC,CAAC,CAAC;EACP,CAAC,CAAC,CAAC,CAAC,CAAC","file":"F:/代码/Vue 代码/erabbit-client-pc-124/src/components/library/xtx-city.vue","sourceRoot":"","sourcesContent":["<template>\n  <div class=\"xtx-city\" ref=\"target\">\n    <div class=\"select\" @click=\"toggle()\" :class=\"{active:visible}\">\n      <span v-if=\"!fullLocation\" class=\"placeholder\">{{placeholder}}</span>\n      <span v-else class=\"value\">{{fullLocation}}</span>\n      <i class=\"iconfont icon-angle-down\"></i>\n    </div>\n    <div class=\"option\" v-if=\"visible\">\n      <div v-if=\"loading\" class=\"loading\"></div>\n      <template v-else>\n        <span class=\"ellipsis\" @click=\"changeItem(item)\" v-for=\"item in currList\" :key=\"item.code\">{{item.name}}</span>\n      </template>\n    </div>\n  </div>\n</template>\n<script>\nimport { computed, reactive, ref } from 'vue'\nimport { onClickOutside } from '@vueuse/core'\nimport axios from 'axios'\nexport default {\n  name: 'XtxCity',\n  props: {\n    fullLocation: {\n      type: String,\n      default: ''\n    },\n    placeholder: {\n      type: String,\n      defulat: '请选择配送地址'\n    }\n  },\n  setup (props, { emit }) {\n    // 显示隐藏数据\n    const visible = ref(false)\n\n    // 所有省市区数据\n    const allCityData = ref([])\n    // 正在加载数据\n    const loading = ref(false)\n\n    // 提供打开和关闭函数\n    const open = () => {\n      visible.value = true\n      // 获取地区数据\n      loading.value = true\n      getCityData().then(data => {\n        allCityData.value = data\n        loading.value = false\n      })\n      // 清空之前选择\n      for (const key in changeResult) {\n        changeResult[key] = ''\n      }\n    }\n    const close = () => {\n      visible.value = false\n    }\n    // 提供一个切换函数给select使用\n    const toggle = () => {\n      visible.value ? close() : open()\n    }\n    // 实现点击组件外部元素进行关闭操作\n    const target = ref(null)\n    onClickOutside(target, () => {\n      // 参数1：监听那个元素\n      // 参数2：点击了该元素外的其他地方触发的函数\n      close()\n    })\n\n    // 实现计算属性：获取当前显示的地区数组\n    const currList = computed(() => {\n      // 默认省一级\n      let list = allCityData.value\n      // 可能：市一级\n      if (changeResult.provinceCode && changeResult.provinceName) {\n        list = list.find(p => p.code === changeResult.provinceCode).areaList\n      }\n      // 可能：县地区一级\n      if (changeResult.cityCode && changeResult.cityName) {\n        list = list.find(c => c.code === changeResult.cityCode).areaList\n      }\n      return list\n    })\n\n    // 定义选择的 省市区 数据\n    const changeResult = reactive({\n      provinceCode: '',\n      provinceName: '',\n      cityCode: '',\n      cityName: '',\n      countyCode: '',\n      countyName: '',\n      fullLocation: ''\n    })\n    // 当你点击按钮的时候记录\n    const changeItem = (item) => {\n      if (item.level === 0) {\n        // 省\n        changeResult.provinceCode = item.code\n        changeResult.provinceName = item.name\n      }\n      if (item.level === 1) {\n        // 市\n        changeResult.cityCode = item.code\n        changeResult.cityName = item.name\n      }\n      if (item.level === 2) {\n        // 地区\n        changeResult.countyCode = item.code\n        changeResult.countyName = item.name\n        // 完整路径\n        changeResult.fullLocation = `${changeResult.provinceName} ${changeResult.cityName} ${changeResult.countyName}`\n        // 这是最后一级，选完了，关闭对话框，通知父组件数据\n        close()\n        emit('change', changeResult)\n      }\n    }\n\n    return { visible, toggle, target, loading, currList, changeItem }\n  }\n}\n// 获取省市区数据函数\nconst getCityData = () => {\n  // 数据：https://yjy-oss-files.oss-cn-zhangjiakou.aliyuncs.com/tuxian/area.json\n  // 1. 当本地没有缓存，发请求获取数据\n  // 2. 当本地缓存，取出本地数据\n  // 返回promise在then获取数据，这里可能是异步操作可能是同步操作\n  return new Promise((resolve, reject) => {\n    // 约定：数据存储在window上的cityData字段\n    if (window.cityData) {\n      resolve(window.cityData)\n    } else {\n      const url = 'https://yjy-oss-files.oss-cn-zhangjiakou.aliyuncs.com/tuxian/area.json'\n      axios.get(url).then(res => {\n        // 缓存\n        window.cityData = res.data\n        resolve(res.data)\n      })\n    }\n  })\n}\n</script>\n<style scoped lang=\"less\">\n.xtx-city {\n  display: inline-block;\n  position: relative;\n  z-index: 400;\n  .select {\n    border: 1px solid #e4e4e4;\n    height: 30px;\n    padding: 0 5px;\n    line-height: 28px;\n    cursor: pointer;\n    &.active {\n      background: #fff;\n    }\n    .placeholder {\n      color: #999;\n    }\n    .value {\n      color: #666;\n      font-size: 12px;\n    }\n    i {\n      font-size: 12px;\n      margin-left: 5px;\n    }\n  }\n  .option {\n    width: 542px;\n    border: 1px solid #e4e4e4;\n    position: absolute;\n    left: 0;\n    top: 29px;\n    background: #fff;\n    min-height: 30px;\n    line-height: 30px;\n    display: flex;\n    flex-wrap: wrap;\n    padding: 10px;\n    > span {\n      width: 130px;\n      text-align: center;\n      cursor: pointer;\n      border-radius: 4px;\n      padding: 0 3px;\n      &:hover {\n        background: #f5f5f5;\n      }\n    }\n    .loading {\n      height: 290px;\n      width: 100%;\n      background: url(../../assets/images/loading.gif) no-repeat center;\n    }\n  }\n}\n</style>\n"]}]}