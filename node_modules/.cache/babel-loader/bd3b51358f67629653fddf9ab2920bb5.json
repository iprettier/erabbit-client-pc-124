{"remainingRequest":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\thread-loader\\dist\\cjs.js!F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\babel-loader\\lib\\index.js!F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\vue-loader-v16\\dist\\templateLoader.js??ref--6!F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!F:\\代码\\Vue 代码\\erabbit-client-pc-124\\src\\views\\login\\components\\callback-bind.vue?vue&type=template&id=9847a1b6&scoped=true","dependencies":[{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\src\\views\\login\\components\\callback-bind.vue","mtime":1621243079000},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1656924649801},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1656924649783},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\babel-loader\\lib\\index.js","mtime":1656924651984},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1656924654079},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1656924649801},{"path":"F:\\代码\\Vue 代码\\erabbit-client-pc-124\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1656924653036}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgY3JlYXRlVk5vZGUgYXMgX2NyZWF0ZVZOb2RlLCB0b0Rpc3BsYXlTdHJpbmcgYXMgX3RvRGlzcGxheVN0cmluZywgcmVzb2x2ZUNvbXBvbmVudCBhcyBfcmVzb2x2ZUNvbXBvbmVudCwgb3BlbkJsb2NrIGFzIF9vcGVuQmxvY2ssIGNyZWF0ZUJsb2NrIGFzIF9jcmVhdGVCbG9jaywgY3JlYXRlQ29tbWVudFZOb2RlIGFzIF9jcmVhdGVDb21tZW50Vk5vZGUsIHdpdGhDdHggYXMgX3dpdGhDdHgsIHdpdGhTY29wZUlkIGFzIF93aXRoU2NvcGVJZCwgcHVzaFNjb3BlSWQgYXMgX3B1c2hTY29wZUlkLCBwb3BTY29wZUlkIGFzIF9wb3BTY29wZUlkIH0gZnJvbSAidnVlIjsKCnZhciBfd2l0aElkID0gLyojX19QVVJFX18qL193aXRoU2NvcGVJZCgiZGF0YS12LTk4NDdhMWI2Iik7CgpfcHVzaFNjb3BlSWQoImRhdGEtdi05ODQ3YTFiNiIpOwoKdmFyIF9ob2lzdGVkXzEgPSB7CiAgY2xhc3M6ICJ1c2VyLWluZm8iCn07CnZhciBfaG9pc3RlZF8yID0gewogIGNsYXNzOiAieHR4LWZvcm0taXRlbSIKfTsKdmFyIF9ob2lzdGVkXzMgPSB7CiAgY2xhc3M6ICJmaWVsZCIKfTsKCnZhciBfaG9pc3RlZF80ID0gLyojX19QVVJFX18qL19jcmVhdGVWTm9kZSgiaSIsIHsKICBjbGFzczogImljb24gaWNvbmZvbnQgaWNvbi1waG9uZSIKfSwgbnVsbCwgLTEpOwoKdmFyIF9ob2lzdGVkXzUgPSB7CiAga2V5OiAwLAogIGNsYXNzOiAiZXJyb3IiCn07CnZhciBfaG9pc3RlZF82ID0gewogIGNsYXNzOiAieHR4LWZvcm0taXRlbSIKfTsKdmFyIF9ob2lzdGVkXzcgPSB7CiAgY2xhc3M6ICJmaWVsZCIKfTsKCnZhciBfaG9pc3RlZF84ID0gLyojX19QVVJFX18qL19jcmVhdGVWTm9kZSgiaSIsIHsKICBjbGFzczogImljb24gaWNvbmZvbnQgaWNvbi1jb2RlIgp9LCBudWxsLCAtMSk7Cgp2YXIgX2hvaXN0ZWRfOSA9IHsKICBrZXk6IDAsCiAgY2xhc3M6ICJlcnJvciIKfTsKCl9wb3BTY29wZUlkKCk7CgpleHBvcnQgdmFyIHJlbmRlciA9IC8qI19fUFVSRV9fKi9fd2l0aElkKGZ1bmN0aW9uIChfY3R4LCBfY2FjaGUsICRwcm9wcywgJHNldHVwLCAkZGF0YSwgJG9wdGlvbnMpIHsKICB2YXIgX2NvbXBvbmVudF9GaWVsZCA9IF9yZXNvbHZlQ29tcG9uZW50KCJGaWVsZCIpOwoKICB2YXIgX2NvbXBvbmVudF9Gb3JtID0gX3Jlc29sdmVDb21wb25lbnQoIkZvcm0iKTsKCiAgcmV0dXJuIF9vcGVuQmxvY2soKSwgX2NyZWF0ZUJsb2NrKF9jb21wb25lbnRfRm9ybSwgewogICAgcmVmOiAiZm9ybUNvbSIsCiAgICAidmFsaWRhdGlvbi1zY2hlbWEiOiAkc2V0dXAubXlTY2hlbWEsCiAgICBhdXRvY29tcGxldGU6ICJvZmYiLAogICAgY2xhc3M6ICJ4dHgtZm9ybSIKICB9LCB7CiAgICBkZWZhdWx0OiBfd2l0aElkKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgIHZhciBlcnJvcnMgPSBfcmVmLmVycm9yczsKICAgICAgcmV0dXJuIFtfY3JlYXRlVk5vZGUoImRpdiIsIF9ob2lzdGVkXzEsIFtfY3JlYXRlVk5vZGUoImltZyIsIHsKICAgICAgICBzcmM6ICRzZXR1cC5hdmF0YXIsCiAgICAgICAgYWx0OiAiIgogICAgICB9LCBudWxsLCA4LCBbInNyYyJdKSwgX2NyZWF0ZVZOb2RlKCJwIiwgbnVsbCwgIkhp77yMIiArIF90b0Rpc3BsYXlTdHJpbmcoJHNldHVwLm5pY2tuYW1lKSArICIg5qyi6L+O5p2l5bCP5YWU6bKc77yM5a6M5oiQ57uR5a6a5ZCO5Y+v5LulUVHotKblj7fkuIDplK7nmbvlvZXlk6Z+IiwgMSldKSwgX2NyZWF0ZVZOb2RlKCJkaXYiLCBfaG9pc3RlZF8yLCBbX2NyZWF0ZVZOb2RlKCJkaXYiLCBfaG9pc3RlZF8zLCBbX2hvaXN0ZWRfNCwgX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfRmllbGQsIHsKICAgICAgICBjbGFzczogW3sKICAgICAgICAgIGVycjogZXJyb3JzLm1vYmlsZQogICAgICAgIH0sICJpbnB1dCJdLAogICAgICAgIG1vZGVsVmFsdWU6ICRzZXR1cC5mb3JtLm1vYmlsZSwKICAgICAgICAib25VcGRhdGU6bW9kZWxWYWx1ZSI6IF9jYWNoZVsxXSB8fCAoX2NhY2hlWzFdID0gZnVuY3Rpb24gKCRldmVudCkgewogICAgICAgICAgcmV0dXJuICRzZXR1cC5mb3JtLm1vYmlsZSA9ICRldmVudDsKICAgICAgICB9KSwKICAgICAgICBuYW1lOiAibW9iaWxlIiwKICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgcGxhY2Vob2xkZXI6ICLnu5HlrprnmoTmiYvmnLrlj7ciCiAgICAgIH0sIG51bGwsIDgsIFsiY2xhc3MiLCAibW9kZWxWYWx1ZSJdKV0pLCBlcnJvcnMubW9iaWxlID8gKF9vcGVuQmxvY2soKSwgX2NyZWF0ZUJsb2NrKCJkaXYiLCBfaG9pc3RlZF81LCBfdG9EaXNwbGF5U3RyaW5nKGVycm9ycy5tb2JpbGUpLCAxKSkgOiBfY3JlYXRlQ29tbWVudFZOb2RlKCIiLCB0cnVlKV0pLCBfY3JlYXRlVk5vZGUoImRpdiIsIF9ob2lzdGVkXzYsIFtfY3JlYXRlVk5vZGUoImRpdiIsIF9ob2lzdGVkXzcsIFtfaG9pc3RlZF84LCBfY3JlYXRlVk5vZGUoX2NvbXBvbmVudF9GaWVsZCwgewogICAgICAgIGNsYXNzOiBbewogICAgICAgICAgZXJyOiBlcnJvcnMuY29kZQogICAgICAgIH0sICJpbnB1dCJdLAogICAgICAgIG1vZGVsVmFsdWU6ICRzZXR1cC5mb3JtLmNvZGUsCiAgICAgICAgIm9uVXBkYXRlOm1vZGVsVmFsdWUiOiBfY2FjaGVbMl0gfHwgKF9jYWNoZVsyXSA9IGZ1bmN0aW9uICgkZXZlbnQpIHsKICAgICAgICAgIHJldHVybiAkc2V0dXAuZm9ybS5jb2RlID0gJGV2ZW50OwogICAgICAgIH0pLAogICAgICAgIG5hbWU6ICJjb2RlIiwKICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgcGxhY2Vob2xkZXI6ICLnn63kv6Hpqozor4HnoIEiCiAgICAgIH0sIG51bGwsIDgsIFsiY2xhc3MiLCAibW9kZWxWYWx1ZSJdKSwgX2NyZWF0ZVZOb2RlKCJzcGFuIiwgewogICAgICAgIG9uQ2xpY2s6IF9jYWNoZVszXSB8fCAoX2NhY2hlWzNdID0gZnVuY3Rpb24gKCRldmVudCkgewogICAgICAgICAgcmV0dXJuICRzZXR1cC5zZW5kKCk7CiAgICAgICAgfSksCiAgICAgICAgY2xhc3M6ICJjb2RlIgogICAgICB9LCBfdG9EaXNwbGF5U3RyaW5nKCRzZXR1cC50aW1lID09PSAwID8gJ+WPkemAgemqjOivgeeggScgOiAiIi5jb25jYXQoJHNldHVwLnRpbWUsICJcdTc5RDJcdTU0MEVcdTUzRDFcdTkwMDEiKSksIDEpXSksIGVycm9ycy5jb2RlID8gKF9vcGVuQmxvY2soKSwgX2NyZWF0ZUJsb2NrKCJkaXYiLCBfaG9pc3RlZF85LCBfdG9EaXNwbGF5U3RyaW5nKGVycm9ycy5jb2RlKSwgMSkpIDogX2NyZWF0ZUNvbW1lbnRWTm9kZSgiIiwgdHJ1ZSldKSwgX2NyZWF0ZVZOb2RlKCJhIiwgewogICAgICAgIG9uQ2xpY2s6IF9jYWNoZVs0XSB8fCAoX2NhY2hlWzRdID0gZnVuY3Rpb24gKCRldmVudCkgewogICAgICAgICAgcmV0dXJuICRzZXR1cC5zdWJtaXQoKTsKICAgICAgICB9KSwKICAgICAgICBocmVmOiAiamF2YXNjcmlwdDo7IiwKICAgICAgICBjbGFzczogInN1Ym1pdCIKICAgICAgfSwgIueri+WNs+e7keWumiIpXTsKICAgIH0pLAogICAgXzogMQogIH0sIDgsIFsidmFsaWRhdGlvbi1zY2hlbWEiXSk7Cn0pOw=="},{"version":3,"sources":["F:\\代码\\Vue 代码\\erabbit-client-pc-124\\src\\views\\login\\components\\callback-bind.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <Form ref=\"formCom\" :validation-schema=\"mySchema\" v-slot=\"{errors}\" autocomplete=\"off\" class=\"xtx-form\">\n    <div class=\"user-info\">\n      <img :src=\"avatar\" alt=\"\" />\n      <p>Hi，{{nickname}} 欢迎来小兔鲜，完成绑定后可以QQ账号一键登录哦~</p>\n    </div>\n    <div class=\"xtx-form-item\">\n      <div class=\"field\">\n        <i class=\"icon iconfont icon-phone\"></i>\n        <Field :class=\"{err:errors.mobile}\" v-model=\"form.mobile\" name=\"mobile\" class=\"input\" type=\"text\" placeholder=\"绑定的手机号\" />\n      </div>\n      <div v-if=\"errors.mobile\" class=\"error\">{{errors.mobile}}</div>\n    </div>\n    <div class=\"xtx-form-item\">\n      <div class=\"field\">\n        <i class=\"icon iconfont icon-code\"></i>\n        <Field :class=\"{err:errors.code}\" v-model=\"form.code\" name=\"code\" class=\"input\" type=\"text\" placeholder=\"短信验证码\" />\n        <span @click=\"send()\" class=\"code\">\n          {{time===0?'发送验证码':`${time}秒后发送`}}\n        </span>\n      </div>\n      <div v-if=\"errors.code\" class=\"error\">{{errors.code}}</div>\n    </div>\n    <a @click=\"submit()\" href=\"javascript:;\" class=\"submit\">立即绑定</a>\n  </Form>\n</template>\n\n<script>\nimport QC from 'qc'\nimport { reactive, ref, onUnmounted } from 'vue'\nimport { Form, Field } from 'vee-validate'\nimport schema from '@/utils/vee-validate-schema'\nimport { userQQBindCode, userQQBindLogin } from '@/api/user'\nimport { useIntervalFn } from '@vueuse/core'\nimport Message from '@/components/library/Message'\nimport { useStore } from 'vuex'\nimport { useRouter } from 'vue-router'\nexport default {\n  name: 'CallbackBind',\n  components: { Form, Field },\n  props: {\n    unionId: {\n      type: String,\n      default: ''\n    }\n  },\n  setup (props) {\n    // 1. 准备下信息：unionId(openId) qq头像 昵称\n    // 2. 完成表单校验\n    // 3. 发送验证吗（校验，定义api，调用，完成倒计时）\n    // 4. 进行绑定（绑定成功就是登录成功）\n    const nickname = ref('null')\n    const avatar = ref('null')\n    if (QC.Login.check()) {\n      QC.api('get_user_info').success(res => {\n        avatar.value = res.data.figureurl_qq_1\n        nickname.value = res.data.nickname\n      })\n    }\n\n    // 表单数据对象\n    const form = reactive({\n      mobile: null,\n      code: null\n    })\n    // 校验规则对象\n    const mySchema = {\n      mobile: schema.mobile,\n      code: schema.code\n    }\n\n    // 发送短信验证码\n    // pause 暂停 resume 开始\n    // useIntervalFn(回调函数,执行间隔,是否立即开启)\n    const formCom = ref(null)\n    const time = ref(0)\n    const { pause, resume } = useIntervalFn(() => {\n      time.value--\n      if (time.value <= 0) {\n        pause()\n      }\n    }, 1000, false)\n    onUnmounted(() => {\n      pause()\n    })\n\n    // 1. 发送验证码\n    // 1.1 绑定发送验证码按钮点击事件\n    // 1.2 校验手机号，如果成功才去发送短信（定义API），请求成功开启60s的倒计时，不能再次点击，倒计时结束恢复\n    // 1.3 如果失败，失败的校验样式显示出来\n    const send = async () => {\n      const valid = mySchema.mobile(form.mobile)\n      if (valid === true) {\n        // 通过\n        if (time.value === 0) {\n        // 没有倒计时才可以发送\n          await userQQBindCode(form.mobile)\n          Message({ type: 'success', text: '发送成功' })\n          time.value = 60\n          resume()\n        }\n      } else {\n        // 失败，使用vee的错误函数显示错误信息 setFieldError(字段,错误信息)\n        formCom.value.setFieldError('mobile', valid)\n      }\n    }\n\n    // 立即绑定\n    const store = useStore()\n    const router = useRouter()\n    const submit = async () => {\n      const valid = formCom.value.validate()\n      if (valid) {\n        userQQBindLogin({\n          unionId: props.unionId,\n          ...form\n        }).then(data => {\n          // 实现和之前登录一样的逻辑\n          // 1. 存储用户信息\n          const { id, account, avatar, mobile, nickname, token } = data.result\n          store.commit('user/setUser', { id, account, avatar, mobile, nickname, token })\n          store.dispatch('cart/mergeCart').then(() => {\n          // 2. 跳转到来源页或者首页\n            router.push(store.state.user.redirectUrl)\n            // 3. 成功提示\n            Message({ type: 'success', text: 'QQ绑定成功' })\n          })\n        }).catch(e => {\n          Message({ type: 'error', text: '绑定失败' })\n        })\n      }\n    }\n\n    return { nickname, avatar, form, mySchema, send, time, formCom, submit }\n  }\n}\n</script>\n\n<style scoped lang='less'>\n.user-info {\n    width: 320px;\n    height: 70px;\n    margin: 0 auto;\n    display: flex;\n    background: #f2f2f2;\n    align-items: center;\n    padding: 0 10px;\n    margin-bottom: 25px;\n    img {\n      background: #f2f2f2;\n      width: 50px;\n      height: 50px;\n    }\n    p {\n      padding-left: 10px;\n    }\n  }\n  .code {\n    position: absolute;\n    right: 0;\n    top: 0;\n    line-height: 50px;\n    width: 80px;\n    color: #999;\n    &:hover {\n      cursor: pointer;\n    }\n  }\n</style>\n"],"sourceRoot":""}]}